#!/usr/local/bin/xs -f
// vim: et ts=4 sw=4 ft=ron
Script([

    Alias ("Clear xs error server terminal",
        Exec (
            cmd: "xs",
            args: ["--error-server-clear"]
        ),
    ),

    Alias ("Build cargo workspace",

        // Normally it's this, but hack-around to restrict compile-error lines
        //Exec (output: Display,
        //   cmd: "xs",
        //   args: ["-f", "dev_exec/build"],
        //),
        List([
            Let ("cargo-run.xs.sh",

                // TODO: create a cargo-max-lines wrapper

                //HACK: this is a pure workaround to capture STDERR.
                // it is relatively safe, because it needs to be piped
                // through a cmd: "sh", which any linter will freak about.
                Expr (
                    r####"
                        xs -c '
                            Script([
                                Exec (output: Display,
                                    cmd: "cargo",
                                    args: ["--color", "always", "test", "-p", "xs"],
                                    cwd: Some("component/cargo"),
                                    env: {
                                        "RUST_BACKTRACE": "1",
                                    }
                                ),
                            ])
                        ' 2>&1
                    "####
                )
            ),
            Exec (output: Display,
                cmd: "sh",
                args: ["-c", (var: "cargo-run.xs.sh")],
            ),
        ])
    ),

    Alias ("Dev-loop meta::sanctioned",
        Exec (output: Display,
            cmd: "xs",
            args: ["-f", "dev_exec/meta::sanctioned"],
        ),
    ),

    Alias (r#"The "life" sequence"#,
        Exec (output: Display,
            cmd: "xs",
            args: ["-f", "dev_exec/life"],
        )
    ),

    Alias ("Update packer configuration"    , Exec (cmd: "xs", args: ["-f", "dev_exec/packer:config"]                       , output: Display)),
    Alias ("Validate packer configuration"  , Exec (cmd: "xs", args: ["-f", "dev_exec/packer:", "-ah", "_", ["validate"]]   , output: Display)),
    Alias ("Inspect packer configuration"   , Exec (cmd: "xs", args: ["-f", "dev_exec/packer:", "-ah", "_", ["inspect"]]    , output: Display)),
    Alias ("Print the generated packer configuration",
        Exec (output: Display,
            cmd: "xs",
            args: [
                "-f", "dev_exec/::read2",
                "-ah", "_", r####"
                    ns: cache
                    itemns: packer
                    item: build.pkr.json
                "####
            ],
        )
    ),

    Alias ("Update cargo-build-tag"         , Exec (cmd: "xs", args: ["-f", "dev_exec/cargo:update_buildtag"]               , output: Display)),

    Alias ("Run the cargo-cache-dir query"  , Exec (cmd: "xs", args: ["-f", "dev_exec/config::cargo.toml.json?cache"]       , output: Display)),

    Alias ("Check if sanctioned topics remain sanctioned",
        Exec (cmd: "xs", args: ["-f", "dev_exec/::sanctioned/sanctioned::spiritus_sanctius"], output: Display)
    ),

    Alias ("Run a random translation with DeepL.com",
        Exec (output: Display,
            cmd: "xs",
            args: [
                "-f", "dev_exec/translate",
                "-ah", "sentence", "Bob the sponge goes on vacation tomorrow morning 8 am.",
            ],
        )
    ),

    Alias ("git ls-files",
        Exec (output: Display,
            cmd: "xs",
            args: [
                "-f", "dev_exec/::sanctioned/git:ls-files",
            ],
        )
    ),

    Alias ("Print the time and date",
        Exec (output: Display,
            cmd: "date"
        )
    ),

    AliasStmt ("Clear xs error server terminal"),
    //AliasStmt ("Build cargo workspace"),

    //AliasStmt ("Dev-loop meta::sanctioned"),

    //AliasStmt (r#"The "life" sequence"#),

    //AliasStmt ("Update packer configuration"),
    //AliasStmt ("Validate packer configuration"),
    //AliasStmt ("Inspect packer configuration"),

    //AliasStmt ("Update cargo-build-tag"),

    //AliasStmt ("Run the cargo-cache-dir query"),

    AliasStmt (r#"Check if sanctioned topics remain sanctioned"#),

    //AliasStmt ("Run a random translation with DeepL.com"),

    //AliasStmt ("git ls-files"),

    //AliasStmt ("Print the generated packer configuration"),

    //AliasStmt ("Print the time and date"),
])//Script
